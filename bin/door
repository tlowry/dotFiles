#!/bin/sh
[ -z "$1" ] && echo "use: door <remote_machine_name> <user_name>" && exit 1

mk_key () {
    ssh-keygen -t rsa -q -f "$1" -N ""
    chmod 400 "$1"
    eval $(ssh-agent)
    ssh-add
}

RUSER="$USER"
[ -z "$2" ] || RUSER="$2"
key="$HOME/.ssh/id_rsa"
[ -f "$key" ] || mk_key "$key"  
cat "$key.pub" | ssh "$RUSER@$1" "cat >> .ssh/authorized_keys"
